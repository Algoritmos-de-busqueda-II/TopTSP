<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - TopTSP</title>
    <link rel="stylesheet" href="styles.css">
        <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <div class="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div>
                        <h1>TopTSP</h1>
                        <div class="logo-subtitle">Plataforma para Competiciones en el TSP</div>
                </div>
            </div>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
            <nav class="nav" id="mobile-nav">
                <button class="mobile-menu-close" onclick="toggleMobileMenu()">‚úï</button>
                <a href="/">Inicio</a>
                <a href="/ranking">Ranking</a>
                <a href="/user">Subir Soluci√≥n</a>
                <a href="/admin" class="active">Administraci√≥n</a>
                <a href="#" onclick="logout()">Cerrar Sesi√≥n</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div id="alert-container"></div>

        <div class="grid grid-2">
            <!-- Create Users Card -->
            <div class="card">
                <h2>Crear Usuarios</h2>
                <p>Introduce los correos electr√≥nicos separados por punto y coma (;)</p>
                
                <form id="create-users-form">
                    <div class="form-group">
                        <label for="emails">Correos Electr√≥nicos:</label>
                        <textarea id="emails" name="emails" class="form-control" rows="4" 
                                  placeholder="usuario1@urjc.es; usuario2@urjc.es; usuario3@urjc.es" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Crear Usuarios</button>
                </form>
            </div>

            <!-- TSP Instance Card -->
            <div class="card">
                <h2>Gestionar Instancia TSP</h2>
                
                <!-- Current Instance Status -->
                <div id="current-instance-status" class="mb-3">
                    <div id="instance-loading">Cargando informaci√≥n de instancia...</div>
                    <div id="instance-exists" class="hidden">
                        <div class="alert alert-info">
                            <strong>Instancia Actual:</strong><br>
                            <span id="current-instance-info"></span>
                        </div>
                        <p><strong>‚ö†Ô∏è Atenci√≥n:</strong> Si subes una nueva instancia, se eliminar√° todo el ranking y las soluciones actuales.</p>
                    </div>
                    <div id="no-instance" class="hidden">
                        <div class="alert alert-warning">
                            <strong>No hay instancia TSP configurada.</strong><br>
                            Sube una instancia para comenzar la competici√≥n.
                        </div>
                    </div>
                </div>
                
                <form id="tsp-form">
                    <div class="form-group">
                        <label for="tsp-data">Datos TSP (Formato TSPLIB):</label>
                        <textarea id="tsp-data" name="tspData" class="form-control" rows="12" 
                                  placeholder="NAME: berlin52&#10;TYPE: TSP&#10;COMMENT: 52 locations in Berlin&#10;DIMENSION: 52&#10;EDGE_WEIGHT_TYPE: EUC_2D&#10;NODE_COORD_SECTION&#10;1 565.0 575.0&#10;2 25.0 185.0&#10;...&#10;EOF" required></textarea>
                        <small>Pega aqu√≠ los datos en formato TSPLIB est√°ndar</small>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <span id="upload-btn-text">Subir Instancia TSP</span>
                    </button>
                </form>
            </div>
        </div>

        <div class="grid grid-2">
            <!-- Ranking Control Card -->
            <div class="card">
                <h2>Control de Ranking</h2>
                <p>Gestiona la visualizaci√≥n y los datos del ranking</p>

                <div class="form-group">
                    <div id="ranking-status" class="mb-2">
                        <span class="status-indicator status-online"></span>
                        <span>Ranking visible</span>
                    </div>

                    <div class="grid grid-2">
                        <button id="toggle-ranking-btn" class="btn btn-secondary" onclick="toggleRanking()">
                            Congelar Ranking
                        </button>

                        <button id="reset-ranking-btn" class="btn btn-danger" onclick="resetRanking()">
                            üóëÔ∏è Reiniciar Ranking
                        </button>
                    </div>

                    <small class="mt-2">
                        <strong>Reiniciar:</strong> Elimina todas las soluciones y resetea el ranking completamente.
                    </small>
                </div>
            </div>

            <!-- Export Data Card -->
            <div class="card">
                <h2>Exportar y Restaurar Datos</h2>
                <p>Descarga archivos de exportaci√≥n, crea backups y restaura la base de datos</p>

                <div class="grid grid-2">
                    <button class="btn btn-success" onclick="exportCSV()">
                        üìÅ Descargar CSV
                    </button>

                    <button class="btn btn-primary" onclick="backupDatabase()">
                        üíæ Backup Base de Datos
                    </button>
                </div>

                <div class="mt-3">
                    <h3>Restaurar Base de Datos</h3>
                    <div class="form-group">
                        <input type="file" id="restore-file" class="form-control" accept=".db">
                        <button class="btn btn-warning btn-block mt-2" onclick="restoreDatabase()">
                            ‚Ü©Ô∏è Restaurar Backup
                        </button>
                    </div>
                </div>

                <div class="mt-2">
                    <small><strong>CSV:</strong> Todas las soluciones subidas</small><br>
                    <small><strong>Backup:</strong> Copia completa de la base de datos</small><br>
                    <small><strong>Restaurar:</strong> Sube un archivo .db para restaurar (se crea backup de seguridad autom√°ticamente)</small>
                </div>
            </div>
        </div>

        <!-- Competition Configuration -->
        <div class="card">
            <h2>Configuraci√≥n de la Competici√≥n</h2>
            
            <div class="grid grid-2">
                <div>
                    <h3>Nombre de la Instancia:</h3>
                    <div class="form-group">
                        <input type="text" id="instance-name-input" class="form-control" 
                               placeholder="Berlin 52" required>
                        <button class="btn btn-primary btn-block mt-2" onclick="setInstanceName()">
                            Actualizar Nombre
                        </button>
                    </div>
                </div>
                <div>
                    <h3>Fecha y Hora de Cierre:</h3>
                    <div class="form-group">
                        <input type="datetime-local" id="end-date-input" class="form-control">
                        <div class="grid grid-2 mt-2">
                            <button class="btn btn-primary" onclick="setEndDate()">
                                Establecer Fecha
                            </button>
                            <button class="btn btn-secondary" onclick="clearEndDate()">
                                Quitar Fecha
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management -->
        <div class="card">
            <h2>Gesti√≥n de Usuarios</h2>
            <p>Administra los usuarios de la competici√≥n</p>
            
            <div class="mb-3">
                <button class="btn btn-primary" onclick="loadUsers()">üîÑ Actualizar Lista</button>
            </div>
            
            <div id="users-table-container">
                <table class="table" id="users-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Estado</th>
                            <th>Mejor Soluci√≥n</th>
                            <th>Fecha Mejor</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <tr>
                            <td colspan="5" class="text-center">Haz clic en "Actualizar Lista" para cargar usuarios</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Solution Validator Card -->
        <div class="card" id="solution-validator-card">
            <h2>Validador de Soluciones</h2>
            <p>Pega aqu√≠ la soluci√≥n en el formato pedido (lista de nodos separados por comas). La herramienta comprobar√°:</p>
            <ul>
                <li>Que la ruta tenga la longitud esperada por la instancia</li>
                <li>Que todos los nodos est√©n dentro del rango de la instancia</li>
                <li>Qu√© n√∫meros faltan o est√°n duplicados</li>
            </ul>

            <div class="form-group">
                <label for="solution-textarea">Soluci√≥n (coma-separada):</label>
                <textarea id="solution-textarea" class="form-control" rows="6" placeholder="Ej: 1,2,3,4,..."></textarea>
            </div>

            <div class="grid">
                <button id="clear-solution-btn" class="btn btn-secondary">Limpiar</button>
            </div>

            <div id="solution-validator-result" class="mt-3"></div>
            <small class="text-muted">La verificaci√≥n usa la instancia TSP cargada actualmente (dimensi√≥n mostrada en la secci√≥n "Gestionar Instancia TSP").</small>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Algoritmos de B√∫squeda II - Universidad Rey Juan Carlos - TopTSP Platform</p>
    </footer>

    <script src="app.js"></script>
    <script src="admin.js"></script>
</body>
</html>